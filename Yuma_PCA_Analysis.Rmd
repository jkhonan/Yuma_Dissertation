---
title: "Yuma_PCA_Analysis"
author: "Jenna Honan"
date: "6/29/2022"
output: html_document
---
# An Analysis of PC1 and PC2 Compared to Yuma Health Outcomes

Note: The following scripts must be run prior to completing this analysis: Data_Clean.Rmd, Yuma_Metals_Analysis.Rmd, Demographics.Rmd, yuma-metals-20210821.Rmd, and Exploration.Rmd. This will provide the accurate dataframes used in the following code.

## Data Descriptions
```{r desc}
library(DataExplorer)
library(ggplot2)
library(ggpubr)
library(gridExtra)
#create_report(Metals) (Remove the # when you actually want to run - takes too much processing power otherwise.)
```


## Data Visualization - Exploratory

### Concentrations by Date
```{r envt_samples_by_collectiondate}
library(dplyr)


colnames(metals.robpca) <- c("ID", "Log10_Mn55", "Log10_Cu65", "Log10_Cd111", "Log10_Hg202", "Log10_Pb208", "Log10_U238", "Site", "PC1", "PC2", "PC3", "PC4", "PC5")

Metals <- merge(Metals, metals.robpca, by = c("ID", "Site"), all=T)

colnames(Metals)[colnames(Metals) %in% c("Log10_Mn55.x", "Log10_Cu65.x", "Log10_Cd111.x", "Log10_Hg202.x", "Log10_Pb208.x", "Log10_U238.x", "PC1.x", "PC2.x", "PC3.x", "PC4.x", "PC5.x")] <- c("Log10_Mn55", "Log10_Cu65", "Log10_Cd111", "Log10_Hg202", "Log10_Pb208", "Log10_U238", "PC1", "PC2", "PC3", "PC4", "PC5")

Metals <- Metals[ , !names(Metals) %in% c("Log10_Mn55.y", "Log10_Cu65.y", "Log10_Cd111.y", "Log10_Hg202.y", "Log10_Pb208.y", "Log10_U238.y", "PC1.y", "PC2.y", "PC3.y", "PC4.y", "PC5.y")]

Metals <- Metals %>%
  filter(!is.na(DOB_year))
 
ggplot(Metals, aes(y=PC1, x=Date, color=as.factor(Site)))+
  geom_point()+
  geom_smooth(se=F)+
  scale_color_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  scale_x_date(date_breaks = "1 month", date_labels =  "%b")+
  ylab("PC1")+
  xlab("Date of Sample Collection")

ggplot(Metals, aes(y=PC2, x=Date, color=as.factor(Site)))+
  geom_point()+
  geom_smooth(se=F)+
  scale_color_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  scale_x_date(date_breaks = "1 month", date_labels =  "%b")+
  ylab("PC2")+
  xlab("Date of Sample Collection")

#Relevant paper: https://www.sciencedirect.com/science/article/pii/S1878535212000263 
```

### Tables and Observations for Each Metal
```{r observations_envt_samples}

library(dplyr)

Metals %>% 
  group_by(Site) %>% 
  summarize(number_NAs_PC1=sum(is.na(PC1)),
            number_NAs_PC2=sum(is.na(PC2)))

#Not sure why I made this:
#Making a table re: PC values
#library(EnvStats)
#knitr::kable(Metals %>%
#               group_by(Site) %>% 
#               summarize(n_PC1=sum(!is.na(PC1)),
#                         geomean_PC1=round(exp(mean(PC1, na.rm = T)), digits = 2),
#                         geosd_PC1=round(exp(sd(PC1, na.rm = T)), digits = 2),
#                         n_PC2=sum(!is.na(PC2)),
#                         geomean_PC2=round(exp(mean(PC2, na.rm = T)), digits = 2),
#                         geosd_PC2=round(exp(sd(PC2, na.rm = T)), digits = 2)))

#create_report(data.melt) (Only run if you need to.)
```

### Distribution of PCA Data
```{r metal_distributions}
hist(Metals$PC1)

hist(Metals$PC2)
```

### Plotting Hormone Levels Against Metal Concentrations
```{r metals_hormones}
#Cortisol against PCA results
PC1_Cortisol <- ggplot(Metals, aes(x=PC1, y=Cortisol))+geom_point()
PC2_Cortisol <- ggplot(Metals, aes(x=PC2, y=Cortisol))+geom_point()

grid.arrange(PC1_Cortisol, PC2_Cortisol)
```

### PCA Stuff from Dean

Pb isotopes were removed because they were all heavily collinear. 
Perhaps so much so that the isotopes were calculated based on one reference one.
Kept Pb208.

The classic vs. robust PCAs were different enough that Dean felt like keeping the robust version was worth it. Even after logging the data, they are still skewed.

PC1 is all positively correlated, which shows that it is an analysis of overall exposure.

PC2 shows which ones are correlated in the same +ve or -ve directions.

### PCA by Gender
```{r PCA_Demo}
library(ggpubr)

Gender_PC1 <- ggplot(Metals, aes(y=PC1, x=as.factor(Gender), fill=as.factor(Gender)))+
  geom_boxplot()+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  ylab("PC1")+
  xlab("")

Gender_PC2 <- ggplot(Metals, aes(y=PC2, x=as.factor(Gender), fill=as.factor(Gender)))+
  geom_boxplot()+
  scale_fill_discrete("Gender", labels=c("1"="Male", "2"="Female"))+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  ylab("PC2")+
  xlab("")

ggarrange(Gender_PC1, Gender_PC2)
ggpubr::ggarrange(Gender_PC1,Gender_PC2,
                  ncol = 2, nrow = 1,
                  common.legend = T)
```

### PCA by BMI
```{r PCA_Demo}
aa <- ggplot(Metals, aes(x=PC1, y=log(bmi)))+
  geom_point()+
  geom_smooth(method=lm, se=F)+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("PC1")+
  ylab("Log BMI (Measured at Sampling Time)")

bb <- ggplot(Metals, aes(x=PC2, y=log(bmi)))+
  geom_point()+
  geom_smooth(method=lm, se=F)+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("PC2")+
  ylab("")

ggpubr::ggarrange(aa,bb,
                  ncol = 2, nrow = 1,
                  common.legend = T)

a <- ggplot(Metals, aes(x=PC1, y=log(bmi), color=as.factor(Gender)))+
  geom_point()+
  geom_smooth(method=lm, se=F)+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("PC1")+
  ylab("Log BMI (Height and Weight Measured at Sampling Time)")

b <- ggplot(Metals, aes(x=PC2, y=log(bmi), color=as.factor(Gender)))+
  geom_point()+
  geom_smooth(method=lm, se=F)+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  scale_color_discrete(name="Gender", labels=c("Male", "Female", NA))+
  labs(Color='Gender')+
  xlab("PC2")+
  ylab("")

ggpubr::ggarrange(a,b,
                  ncol = 2, nrow = 1,
                  common.legend = T)
```

### PCA by age
```{r PCA_Demo}
e <- ggplot(Metals, aes(y=PC1, x=age))+
  geom_point()+
  geom_smooth(method=lm, se=F)+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("Age")+
  ylab("PC1")

f <- ggplot(Metals, aes(y=PC2, x=age))+
  geom_point()+
  geom_smooth(method=lm, se=F)+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("Age")+
  ylab("PC2")

ggpubr::ggarrange(e,f,
                  ncol = 2, nrow = 1,
                  common.legend = T)

c <- ggplot(Metals, aes(y=PC1, x=age, color=as.factor(Gender)))+
  geom_point()+
  geom_smooth(method=lm, se=F)+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("Age")+
  ylab("PC1")

d <- ggplot(Metals, aes(y=PC2, x=age, color=as.factor(Gender)))+
  geom_point()+
  geom_smooth(method=lm, se=F)+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  scale_color_discrete(name="Gender", labels=c("Male", "Female", NA))+
  labs(Color='Gender')+
  xlab("Age")+
  ylab("PC2")

ggpubr::ggarrange(c,d,
                  ncol = 2, nrow = 1,
                  common.legend = T)
```

``` {r other_outcomes}
g <- ggplot(Metals, aes(y=PC1, x=as.factor(Pesticides), fill=as.factor(Pesticides)))+
         geom_boxplot()+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC1")

h <- ggplot(Metals, aes(y=PC2, x=as.factor(Pesticides), fill=as.factor(Pesticides)))+
         geom_boxplot()+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC2")

ggpubr::ggarrange(g,h,
                  ncol = 2, nrow = 1,
                  common.legend = T)

i <- ggplot(Metals, aes(y=PC1, x=as.factor(Water_home), fill=as.factor(Water_home)))+
         geom_boxplot()+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC1")

j <- ggplot(Metals, aes(y=PC2, x=as.factor(Water_home), fill=as.factor(Water_home)))+
         geom_boxplot()+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC2")

ggpubr::ggarrange(i,j,
                  ncol = 2, nrow = 1,
                  common.legend = T)

k <- ggplot(subset(Metals, !is.na(Metals$Water_work)), aes(y=PC1, x=as.factor(Water_work), fill=as.factor(Water_work)))+
         geom_boxplot()+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC1")

l <- ggplot(subset(Metals, !is.na(Metals$Water_work)), aes(y=PC2, x=as.factor(Water_work), fill=as.factor(Water_work)))+
         geom_boxplot()+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC2")

ggpubr::ggarrange(k,l,
                  ncol = 2, nrow = 1,
                  common.legend = T)

m <- ggplot(Metals, aes(y=PC1, x=as.factor(Lived_in_Yuma), fill=as.factor(Lived_in_Yuma)))+
         geom_boxplot()+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC1")

n <- ggplot(Metals, aes(y=PC2, x=as.factor(Lived_in_Yuma), fill=as.factor(Lived_in_Yuma)))+
         geom_boxplot()+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC2")

ggpubr::ggarrange(m,n,
                  ncol = 2, nrow = 1,
                  common.legend = T)

o <- ggplot(subset(Metals, !is.na(Metals$Dental_health)), aes(y=PC1, x=as.factor(Dental_health), fill=as.factor(Dental_health)))+
         geom_boxplot()+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC1")

p <- ggplot(subset(Metals, !is.na(Metals$Dental_health)), aes(y=PC2, x=as.factor(Dental_health), fill=as.factor(Dental_health)))+
         geom_boxplot()+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC2")

ggpubr::ggarrange(o,p,
                  ncol = 2, nrow = 1,
                  common.legend = T)

q <- ggplot(subset(Metals, !is.na(Metals$arthritis)), aes(y=PC1, x=as.factor(arthritis), fill=as.factor(arthritis)))+
         geom_boxplot()+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC1")

r <- ggplot(subset(Metals, !is.na(Metals$arthritis)), aes(y=PC2, x=as.factor(arthritis), fill=as.factor(arthritis)))+
         geom_boxplot()+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC2")

ggpubr::ggarrange(q,r,
                  ncol = 2, nrow = 1,
                  common.legend = T)

s <- ggplot(subset(Metals, !is.na(Metals$gout)), aes(y=PC1, x=as.factor(gout), fill=as.factor(gout)))+
         geom_boxplot()+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC1")

t <- ggplot(subset(Metals, !is.na(Metals$gout)), aes(y=PC2, x=as.factor(gout), fill=as.factor(gout)))+
         geom_boxplot()+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC2")

ggpubr::ggarrange(s,t,
                  ncol = 2, nrow = 1,
                  common.legend = T)


library(tidyverse)
library(ggpubr)



u <- ggplot(subset(Metals, !is.na(Metals$chf)), aes(y=PC1, x=as.factor(chf), fill=as.factor(chf)))+
         geom_boxplot()+
  theme(legend.position = "none",
        panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC1")

v <- ggplot(subset(Metals, !is.na(Metals$chf)), aes(y=PC2, x=as.factor(chf), fill=as.factor(chf)))+
         geom_boxplot()+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  xlab("")+
  ylab("PC2")

ggpubr::ggarrange(u, v,
                  ncol = 2, nrow = 1,
                  common.legend = T)


```