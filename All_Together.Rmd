---
title: "Yuma Metals and Health Outcomes Analysis"
author: "Jenna Honan"
date: "9/5/2022"
output: html_document
---

## Libraries
```{r libraries}
library(readxl)
library(DataExplorer)
library(reshape2)
library(ggplot2)
library(dplyr)
library(EnvStats)
library(gridExtra)
library(lubridate)
library(tidyverse)
library(rospca)
library(knitr)
```

#Data Cleaning
$Note:$ This is the first code to be run for this analysis.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
## Importing Data

Metals <- read_excel("~/Desktop/Research/Yuma/Yuma - R Project/Yuma Metals Project_EMR_Editted 23Aug2021 mental health & ID removed.xlsx", sheet = "Sqrt 2")

#Reformating Date Data
Metals$Date <- as.Date(as.numeric(Metals$Date), origin = "1899-12-30")
Metals$DOB <- as.Date(as.numeric(Metals$DOB), origin = "1899-12-30")

#Notes: Difference Between Metals and Metalloids
  #Metals have unique metallic properties such as shiny appearance, high density, higher melting points and electric conductivity. 
  #However, metalloids possess both metal properties and non-metal properties. 
  #Metals are located in the left side of the periodic table while metalloids are in the middle of metals and non-metals.
```

## Data Cleaning
```{r dataclean}
#Using 'Perchlorate codebook.pdf' as data dictionary

### Additional Notes from Mark Remiker, August 2022 ###
#Num_in_household 
#-	No data entry error here - that’s the response!  
#Num_children
#-	Same!  That’s the actual response.  
#Armed_forces
#-	1 = Yes, 2 = No, 3 = Don’t know, 4 = Refuse
#-	61 = Yes, 62 = No, 63 = Don’t know, 64 = Refuse
unique(Metals$Armed_forces)
Metals$Armed_forces[Metals$Armed_forces==62] <- 2
unique(Metals$Armed_forces)
#Employment
#-	1 = Working for pay, 2= Self-employed, 3= Looking for work, 4= Temporarily laid off, 5 = Retired, 6= A homemaker, 7= Student, 8= Permanently disabled, 9= Maternity/sick leave, 10= Other, 11= Don’t know, 12 = Refused
#Health_care
#-	21= Yes, 22= No, 24= I don’t know, 23= Refuse
unique(Metals$Health_care)
Metals$Health_care[Metals$Health_care==21] <- 1
Metals$Health_care[Metals$Health_care==22] <- 2
unique(Metals$Health_care)
#Health_consult
#-	21= Yes, 22= No, 24= I don’t know, 23= Refuse
unique(Metals$Health_consult)
Metals$Health_consult[Metals$Health_consult==31] <- 1
Metals$Health_consult[Metals$Health_consult==32] <- 2
Metals$Health_consult[Metals$Health_consult==33] <- 3
Metals$Health_consult[Metals$Health_consult==34] <- 4
Metals$Health_consult[Metals$Health_consult==35] <- 5
unique(Metals$Health_consult)
#Health_consult_place
#-	Blank and “.”  - Missing data
#Health options/Medical conditions
#-	1= Yes, 2= No, 3= Don’t know, 4= Refused 
#HTN, HTN_hx_meds, Cholesterol, Cholesterol_meds
#-	5= Yes, 6= No, 7= Don’t know 
unique(Metals$HTN)
Metals$HTN[Metals$HTN==5] <- 1
Metals$HTN[Metals$HTN==6] <- 2
Metals$HTN[Metals$HTN==7] <- 3
unique(Metals$HTN)
unique(Metals$HTN_hx_meds)
Metals$HTN_hx_meds[Metals$HTN_hx_meds==5] <- 1
Metals$HTN_hx_meds[Metals$HTN_hx_meds==6] <- 2
unique(Metals$HTN_hx_meds)
unique(Metals$Cholesterol)
Metals$Cholesterol[Metals$Cholesterol==5] <- 1
Metals$Cholesterol[Metals$Cholesterol==6] <- 2
Metals$Cholesterol[Metals$Cholesterol==7] <- 3
unique(Metals$Cholesterol)
#Diabetes
#-	31= Yes, 32= No, 33= Prediabetes 35= Don't know
unique(Metals$Diabetes)
Metals$Diabetes[Metals$Diabetes==31] <- 1
Metals$Diabetes[Metals$Diabetes==32] <- 3
Metals$Diabetes[Metals$Diabetes==33] <- 2
Metals$Diabetes[Metals$Diabetes==35] <- 4
unique(Metals$Diabetes)
#Dm_age
#-	“.” = missing data, no response.
#Endo: does the participant have endocrinology data
#-	.00 = No, 1.00 = yes 
unique(Metals$endo)
#These are correct here.
#EMR
#-	0= No, 1= Yes

#Generally "." is missing data
Metals2 <- Metals %>% 
  select(-c(Date, DOB))

Metals2[Metals2=="."] <- NA

Metals3 <- Metals %>% 
  select(c(Date, DOB))

Metals <- cbind(Metals2, Metals3)

remove(Metals2)
remove(Metals3)
#Participant C1045 was 9/4/2018

Metals$Date[Metals$Date=="2013-01-04"] <- "2018-09-04"
```

#### Wondering About Recodes
Looks like this was converted to just 1=yes, 0=no.
```{r recoded, include=F}
Metals[grepl('recode', colnames(Metals))]
```

# An Analysis of Metals in Yuma County, Arizona and their Effects on Health Outcomes
This project will consider the associations between concentration levels of metals and 
metalloids measured in hair samples of 330 Yuma County residents in 2018 and the prevalence of negative health outcomes, including endocrine disruption, reproductive disorders, obesity, and neurological disorders.

Note: Before running this code, Data_Clean.Rmd should be run to clean the dataset used in this analysis.

## Data Descriptions
```{r desc}
#create_report(Metals) (Remove the # when you actually want to run - takes too much processing power otherwise.)
```


## Data Visualization - Exploratory
### Metal Concentrations
```{r metals}
#The initial columns are for Mn55, Cu65, Cd111, Hg202, Pb208, and U238.
#There are additional columns with metal concentrations for arsenic and iron (As_75 and Fe_57) that come later after the hormone level columns.
#The differences in naming format make me think these were analyzed either at different times or on different machines or with different techniques, perhaps? 
#Going to make things uniform for posterity.
colnames(Metals)[colnames(Metals) == "As_75"] <- "As75"
colnames(Metals)[colnames(Metals) == "Fe_57"] <- "Fe57"
```

### Melting Metals Together :)
```{r melting_data}

data.melt <- melt(Metals,id.vars=c('ID','Date'), measure.vars=c('Mn55','Cu65','Cd111', 'Hg202', 'Pb208', 'U238', 'As75', 'Fe57'))

ggplot(data.melt) +
  geom_boxplot(aes(y=log(value), fill=variable))+
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),
        panel.background = element_rect(fill="#ffffff"),
        axis.line = element_line(color="#000000"))+
  ylab("Ln Concentration (ug/g)")+
  labs(fill='Metals')
```

### Concentrations by Date
```{r envt_samples_by_collectiondate}
#There is a single data point for the year 2013, with the rest being April-November 2018.
#This is likely either a mistake in input or some other error, but I will not include this point in subsequent analysis.
#The concentration values for this single row are blank anyway.
ggplot(data.melt, aes(y=log(value), x=Date, color=variable))+
  geom_point()+
  geom_smooth(se=F)+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  scale_x_date(date_breaks = "1 month", date_labels =  "%b")+
  ylab("Ln Concentration (Units)")+
  xlab("Date of Sample Collection, 2018")+
  labs(color='Metals')

#Relevant paper: https://www.sciencedirect.com/science/article/pii/S1878535212000263 
```

### Tables and Observations for Each Metal
```{r observations_envt_samples}
data.melt %>% 
  group_by(variable) %>% 
  summarize(number_NAs=sum(is.na(value)))

#Seeing if there are negative concentrations
data.melt %>% 
  group_by(variable) %>% 
  summarize(n_negative=sum(value<0, na.rm = T))
#There are twelve negative concentration levels of arsenic. This will mess with taking the lognormal to transform.
#Need to look up what to do when concentrations in a dataset are negative. Do you ignore? Do you replace with DL/sqrt(2)? Do you leave them as is and it's just tough luck?
#For now I will simply ignore!

#Making a table re: metal concentration values
data.melt$value <- as.numeric(data.melt$value)
knitr::kable(data.melt %>%
               filter(value>=0) %>% #This is ignoring negative concentrations in dataset, of which As75 has twelve.
               group_by(variable) %>% 
               summarize(n=sum(!is.na(value)),
                         geomean=round(geoMean(value, na.rm = T), digits = 2),
                         geosd=round(geoSD(value, na.rm = T), digits = 2)))

#create_report(data.melt) (Only run if you need to.)
```

### Distribution of Metals Data
```{r metal_distributions}

hist(Metals$Mn55)

hist(Metals$Cu65)

hist(Metals$Cd111)

hist(Metals$Hg202)

hist(Metals$Pb208)

hist(Metals$U238)

hist(Metals$As75)
#If negative values are excluded, lognormal is appropriate.

hist(Metals$Fe57)
```

### Hormone Levels
```{r hormones, warning=F}
#Looking at total levels first before free 
TSH <- ggplot(Metals) +geom_boxplot(aes(y=TSH)) +theme(axis.ticks.x = element_blank(),axis.text.x = element_blank()) +theme_classic() +ylab("TSH (units)")
T3 <- ggplot(Metals) +geom_boxplot(aes(y=TotalT3)) +theme(axis.ticks.x = element_blank(),axis.text.x = element_blank()) +theme_classic() +ylab("Total T3 (units)")
T4 <- ggplot(Metals) +geom_boxplot(aes(y=TotalT4)) +theme(axis.ticks.x = element_blank(),axis.text.x = element_blank()) +theme_classic() +ylab("Total T4 (units)")
Cortisol <- ggplot(Metals) +geom_boxplot(aes(y=Cortisol)) +theme(axis.ticks.x = element_blank(),axis.text.x = element_blank()) +theme_classic() +ylab("Cortisol (units)")

grid.arrange(TSH, Cortisol, T3, T4)

#Looking at distributions
hist(Metals$TSH)
hist(Metals$TotalT3)
hist(Metals$TotalT4)
hist(Metals$Cortisol)

#Levels by date
data.melt2 <- melt(Metals,id.vars=c('ID','Date'), measure.vars=c('TSH','TotalT3','TotalT4', 'Cortisol'))

ggplot(data.melt2, aes(y=value, x=Date, color=variable))+
  geom_point()+
  geom_smooth(se=F)+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  scale_x_date(date_breaks = "1 month", date_labels =  "%b")+
  ylab("Hormone Levels (Units)")+
  xlab("Date of Sample Collection")+
  labs(color='Hormones')
#There are some dates here from 2013, but the concentration values are blank, so I removed them from the graphical display.

#create_report(data.melt2) - Use when needed.
```

### Plotting Hormone Levels Against Metal Concentrations
```{r metals_hormones}
#This may be irrelevant if we use a PCA, but doing it anyway just to see...
#I can always do this again but with the simplified results of the PCA

#Cortisol
Mn_Cortisol <- ggplot(Metals, aes(x=log(Mn55), y=Cortisol))+geom_point()
Cu_Cortisol <- ggplot(Metals, aes(x=log(Cu65), y=Cortisol))+geom_point()
Cd_Cortisol <- ggplot(Metals, aes(x=log(Cd111), y=Cortisol))+geom_point()
Hg_Cortisol <- ggplot(Metals, aes(x=log(Hg202), y=Cortisol))+geom_point()
Pb_Cortisol <- ggplot(Metals, aes(x=log(Pb208), y=Cortisol))+geom_point()
U_Cortisol <- ggplot(Metals, aes(x=log(U238), y=Cortisol))+geom_point()
As_Cortisol <- ggplot(Metals, aes(x=log(As75), y=Cortisol))+geom_point()
Fe_Cortisol <- ggplot(Metals, aes(x=log(Fe57), y=Cortisol))+geom_point()

grid.arrange(Mn_Cortisol, Cu_Cortisol, Cd_Cortisol, Hg_Cortisol, Pb_Cortisol, U_Cortisol, As_Cortisol, Fe_Cortisol)
```

# An Analysis of Survey and Sample Participant Demographics in Yuma County, Arizona 
This project will consider the associations between concentration levels of metals and 
metalloids measured in hair samples of 330 Yuma County residents in 2018 and the prevalence of negative health outcomes, including endocrine disruption, reproductive disorders, obesity, and neurological disorders.

$Note:$ Before running this code, Data_Clean.Rmd and Yuma_Metals_Analysis.Rmb should be run to clean the dataset used in this analysis.

## General Demographics Table
```{r demographics}
colnames(Metals)

#Date range of responses
kable(Metals %>% 
        # transform to date format with lubridate
        mutate(Date = ymd(Date)) %>% 
        # find min and max
        summarise(min = min(Date, na.rm = T),
                  max = max(Date, na.rm = T)))

kable(Metals %>%
        filter(!is.na(ID)) %>%
        summarize("n"=length(ID)))

kable(t(Metals %>%
          summarize("Male"=sum(Gender==1, na.rm = T),
                    "Female"=sum(Gender==2, na.rm = T),
                    "Refused Gender"=sum(Gender==3, na.rm = T),
                    "18-39"=sum(age>=18 & age<40, na.rm = T),
                    "40-59"=sum(age>=40 & age<60, na.rm = T),
                    "60+"=sum(age>=60, na.rm = T),
                    "Hispanic"=sum(Ethnicity==1, na.rm = T),
                    "Not Hispanic"=sum(Ethnicity==2, na.rm = T),
                    "Married"=sum(Marital_status==1, na.rm=T),
                    "Widowed"=sum(Marital_status==2, na.rm=T),
                    "Divorced"=sum(Marital_status==3, na.rm=T),
                    "Separated"=sum(Marital_status==4, na.rm=T),
                    "Never married"=sum(Marital_status==5, na.rm=T),
                    "No school"=sum(Education==1,  na.rm = T),
                    "Elementary school"=sum(Education==2,  na.rm = T),
                    "Middle school"=sum(Education==3,  na.rm = T),
                    "High school"=sum(Education==4,  na.rm = T),
                    "College"=sum(Education==5,  na.rm = T),
                    "Advanced degree"=sum(Education==6,  na.rm = T),
                    "Other"=sum(Education==7,  na.rm = T))))

kable(t(Metals %>%
          group_by(Site) %>%
          summarize("n"=length(Site),
                    "Male"=sum(Gender==1, na.rm = T),
                    "Female"=sum(Gender==2, na.rm = T),
                    "Refused Gender"=sum(Gender==3, na.rm = T),
                    "18-39"=sum(age>=18 & age<40, na.rm = T),
                    "40-59"=sum(age>=40 & age<60, na.rm = T),
                    "60+"=sum(age>=60, na.rm = T),
                    "Hispanic"=sum(Ethnicity==1, na.rm = T),
                    "Not Hispanic"=sum(Ethnicity==2, na.rm = T),
                    "Married"=sum(Marital_status==1, na.rm=T),
                    "Widowed"=sum(Marital_status==2, na.rm=T),
                    "Divorced"=sum(Marital_status==3, na.rm=T),
                    "Separated"=sum(Marital_status==4, na.rm=T),
                    "Never married"=sum(Marital_status==5, na.rm=T),
                    "No school"=sum(Education==1,  na.rm = T),
                    "Elementary school"=sum(Education==2,  na.rm = T),
                    "Middle school"=sum(Education==3,  na.rm = T),
                    "High school"=sum(Education==4,  na.rm = T),
                    "College"=sum(Education==5,  na.rm = T),
                    "Advanced degree"=sum(Education==6,  na.rm = T),
                    "Other"=sum(Education==7,  na.rm = T))))

#Below will give a % of folks who rated their general health as fair (4) or poor (5)
(Metals %>% 
        filter(General_health==4|General_health==5) %>% 
        summarise(Count = n()))/sum(!is.na(Metals$General_health))

#Below will give a % of folks who are listed as having a "thyroid problem"
(Metals %>% 
  filter(thyroid_prob_D==1) %>% 
  summarise(Count = n()))/sum(!is.na(Metals$thyroid_prob_D))

(Metals %>% 
  filter(emr_thyroid_problem==1) %>% 
  summarise(Count = n()))/sum(!is.na(Metals$emr_thyroid_problem))
```

## Age
```{r age}
Metals$age <- as.numeric(Metals$age)

knitr::kable(Metals %>%
               summarise(mean=round(mean(age, na.rm=T), digits=1),
                         median=round(median(age, na.rm=T), digits=1),
                         min=round(min(age, na.rm=T), digits=1),
                         max=round(max(age, na.rm=T), digits=1),
                         NAs=sum(is.na(age))))
```

## Height, Weight, and BMI
```{r bmi}
knitr::kable(summary(round(Metals[c("emr_height_inches", "emr_weight", "emr_bmi", "height_total", "Weight", "bmi")]), digits=1), col.names = c("EMR Height (inches)", "EMR Weight (lbs)", "EMR BMI", "Measured Height (inches)", "Measured Weight (lbs)", "Measured BMI"))
```

### Determining if Differences Exist in EMR versus Measured Data
```{r diff_bmi, include=F}
Metals[grepl('emr', colnames(Metals))]
```

```{r t_test_bmi_survey_emr}
t.test(Metals$emr_bmi, Metals$bmi, paired = T)
#Some data is missing from the EMRs for BMI. The BMIs between the the EMR and measurements are different in general, but also there are differences between the paired data.
```

# Statistical Differences Among Sites
```{r stat_difference}
summary(aov(Gender~as.factor(Site), data=Metals))

summary(aov(age~as.factor(Site), data=Metals))

summary(aov(Ethnicity~as.factor(Site), data=Metals))

summary(aov(Marital_status~as.factor(Site), data=Metals))

summary(aov(Education~as.factor(Site), data=Metals))


pairwise.t.test(Metals$Gender, as.factor(Metals$Site), adj="bonf")

pairwise.t.test(Metals$age, as.factor(Metals$Site), adj="bonf")

pairwise.t.test(Metals$Ethnicity, as.factor(Metals$Site), adj="bonf")

pairwise.t.test(Metals$Marital_status, as.factor(Metals$Site), adj="bonf")

pairwise.t.test(Metals$Education, as.factor(Metals$Site), adj="bonf")
```

# Overview
#### PCA Code Written by Dr. Dean Billheimer
Explore the distributional properties of (hair?) metals concentrations from
Yuma, AZ.  Also, use Rmd file to illustrate use of R and markdown for
computationally reproducible research.

### Changes since 2021-08-21
1. Values missing all metals are true missing -- insuffucent sample.
2. Values with missing Hg are also true missing (about 89 of these)
- fit PCA excluding missing Hg
- 2nd fit using imputed Hg from other metals data.
3. drop sample R1108 - missing Cu value - not identified in spectrum. This was included in a batch of
   samples that failed QA/QC check 

### Major changes since 2020-07-03 version
1. Updated data from Jonathan Credo - using 2021-08-23 version - sheet 3
2. Many of the NAs are true missing -
3. Jonathan re-coded BDL values to DL/sqrt(2)
4. Re-run the analysis.
5. Produce a new data set with robust PCA components for Jonathan's use.

### Major changes since 2020-06-23 version
1. Omit observations where most metals are unmeasured 
2. Omit Pb206 and 207
3. What to do about Hg NAs?

### Takeaway
Standard and robust PCA yield generally similar results.  There are enough
differences, however, that the robust method would be my first choice for
data summarization.

# R Stuff
## Set-up Environment and Read Data
```{r, setup2}
#setwd
setwd("~/Desktop/Research/Yuma/Yuma - R Project/")

## read data
##filename <- c("Yuma Metals Project - EMR 19Jun20.xlsx")
filename <- c("Yuma Metals Project_EMR_Editted 23Aug2021 mental health & ID removed.xlsx") ## new data set
tmp <- read_excel(filename, sheet=3)
dim(tmp) ## 330 222 ## same dimensions
 names(tmp)
 ##  [1] "ID"                        "Mn55"                     
 ##  [3] "Cu65"                      "Cd111"                    
 ##  [5] "Hg202"                     "Pb206"                    
 ##  [7] "Pb207"                     "PB208"                    
 ##  [9] "U238"                      "Site"                     
 ## [11] "Date"                      "Gender"                   

## head(tmp)

## keep only ID, metals and Site, cast to data frame
metals <- data.frame(tmp[,c(1:8)])
names(metals)  ## omitted Pb206 and Pb207
## metals check format
```

## Perform Initial Checks and Summary

The summary below shows there are 123 NAs for nearly all of the metals. Hg202 is
the exception with 212 NAs.

Data exploration shows that the NA pattern is consistent across the metals. If
one is missing, all are missing.

There are fewer measures at site 1.  More missing values at site 1 (51/78) and
at site 3 (48/126) compared with site 2 (24/126)

```{r, checks}
## Initial summary
summary(metals)

## Number of Observations per Site
table(metals$Site) ## 78 126 and 126.  Fewer at site 1

## Number of values > BDL by Site
table(metals$Site, !is.na(metals[,2])) ## Observation indicator by site
```



### Metals Concentrations
The figure below shows metals concentrations on log10 scale.  NA values are
omitted.

The shape of the Pb distributions are nearly identical (omitted 206 and 207). On the whole, these
distributions are not as bad as I feared.  All are stil right-skewed after
transformation, but they do not look pathologic.

```{r, intitialPlots, fig.cap="Metals concentrations - log10 scale"}
## change from wide to long format for plotting

metals %>% pivot_longer(-c(ID, Site), names_to="Metal", values_to="Concentration") %>%
    ggplot(aes(x=Concentration)) + geom_density() +
        scale_x_log10() + facet_wrap(~ Metal) +
            ggtitle("Distributions of Metals Concentrations (log10 transform)")
```

### Remove Missing Values

Values labeled as NA across (nearly all metals) are not measured.
For each observation with missing metals, omit the observation.  In addition
there are 89 observations with missing Hg values.  We may impute these missing values
based on site and other observed metals



*Note* - Other BDL values are replaced with 1/2 the limit of detection.

```{r, omitmissing}
names(metals)
metals.obs <- metals[!is.na(metals[,2]), ]
## for Hg, replace NA and zero with 0.029/sqrt(2)
##sort(metals.obs[,"Hg202"])
## Hg.subs <- 0.029 /sqrt(2)

metals.complete.cases <- metals.obs %>% filter(!is.na(Cu65)) %>% 
    filter(!is.na(Hg202)) ## ID R1108 also missing Hg, other metals observed

dim(metals.complete.cases) ## 111 8 wow - small data set
summary(metals.complete.cases)

metals.impute.Hg <- metals.obs %>% filter(!is.na(Cu65)) %>% 
    filter(is.na(Hg202))

metals.complete.log10 <- cbind(ID=metals.complete.cases[,"ID"],
                               log10(metals.complete.cases[,2:7]),
                               Site=metals.complete.cases[,"Site"])

summary(metals.complete.log10)
round(cor(metals.complete.log10[,2:7]), 2)

metals.impute.log10 <- cbind(ID=metals.impute.Hg[,"ID"],
                               log10(metals.impute.Hg[,2:7]),
                               Site=metals.impute.Hg[,"Site"])
summary(metals.impute.log10)
metals.impute.Hg

### fit regression line for Hg
Hg.lm <- lm(Hg202 ~ as.factor(Site) + Mn55 + Cu65 + Cd111 + Pb208 + U238,
            data=metals.complete.log10) 
qplot(metals.complete.log10[,"Hg202"], predict(Hg.lm))
qplot( predict(Hg.lm), resid(Hg.lm))

Hg.imputed <-  predict(Hg.lm, newdata=metals.impute.log10)

metals.fillin.log10 <- metals.impute.log10
metals.fillin.log10[,"Hg202"] <- Hg.imputed

summary(metals.fillin.log10)

## combine complete cases with Hg imputed cases
metals.allobs.log10 <- rbind(metals.complete.log10, metals.fillin.log10)
## dim(metals.allobs.log10) ## 206 8  ## OK obs with missing Cu65 is omitted.
## dim(metals.obs) ## 207 8

## check summary
summary(metals.allobs.log10)
```

### Adjusted (Hg Imputed) Concentrations
New figure with Hg values imputed using regression on other metals

```{r, checkPlots, fig.cap="Metals concentrations - log10 scale"}
## change from wide to long format for plotting

metals.allobs.log10 %>% pivot_longer(-c(ID, Site), names_to="Metal", values_to="Concentration") %>%
    ggplot(aes(x=Concentration)) + geom_density() +
         facet_wrap(~ Metal) +
            ggtitle("Distributions of Metals Concentrations (missin Hg values imputed, log10 transform)")
```

## Robust PCA

Now we move on to Robust PCA.  We use the method described by the following papers.

1. Hubert, M., Rousseeuw, P. J., and Vanden Branden, K. (2005), “ROBPCA: A New
   Approach to Robust Principal Component Analysis,” Technometrics, 47, 64–79. 

2. Engelen, S., Hubert, M. and Vanden Branden, K. (2005), “A Comparison of Three
   Procedures for Robust PCA in High Dimensions", Austrian Journal of
   Statistics, 34, 117–126. 

3. Hubert, M., Rousseeuw, P. J., and Verdonck, T. (2009), “Robust PCA for Skewed
   Data and Its Outlier Map," Computational Statistics & Data Analysis, 53,
   2264–2274. 

This is implemented in the R package $rospca$


The plot below shows results from the robust PCA.  The "Score distance"
describes the leverage that an indvidual point has in determining the fitted PCA
surface. The "Orthogonal distance" shows the distance to the fitted surface.

Thus, points 31, 48, 85, and 200 heaviy influence the slope of the PCA surface
(the loadings). Conversely, point 143 is a large distance from the mass of
points, but has little influence on the loadings.

The eigenvalues (bottom of the box) show that of the variation is captured
in PC1 (41%) and PC2 (20%).

```{r, robpca}
##install.packages("rospca", repos="http://cran.r-project.org")

##dim(metals.adjusted)
##metals.log10 <- as.matrix(log10(metals.adjusted[, 2:7]))
colnames(metals.allobs.log10)

## round(cor(metals.log10), 2) ## check pairwise correlation
### == original full PCA

metals.pca <- robpca(metals.allobs.log10[,2:7], k=5, alpha=.7, ndir="all", skew=T)

## Eigenvalues show variation in different components
cat("Total Variance in PC1 and PC2\n")
round(metals.pca[[2]]/sum(metals.pca[[2]]), 3) ## variation in PC's is as expected across components

diagPlot(metals.pca)
```

The eigenvalues show that PC1 and PC2 exhibit the majority of the variance, PC
3-5 are smaller.  In general, the diagnostic plot suggests that robust PCA is warranted

### PCA Loadings
The loadings are shown below. 


```{r, loadings}
round(metals.pca$loadings, 3)
names(metals.allobs.log10[,2:7])
##plot(metals.pca$loadings, pch=rownames(metals.pca$loadings))
```
There are a few of points to notice about the loadings

1. All components of PC1 have the same sign. As before, this suggests a "common" effect to
   all measurements. For example, all metals tend to be "high" or "low"
   together. May be caused either by global high-low exposure of inviduals, or
   by mass spectrometry measurement issues.

2. PC1 has highest loading for Pb208, Mn55, and Cu65

2. For PC2, U238 is the biggest driver. 


### PCA Scores for Individuals

Finally, we look at PCA scores by site.  The second figure below shows clearly
that site 2 has slightly more variation than site 3. But not bad. It appears
that site 3 may be slightly greater on PC2 than is site 2.


```{r, pcaplot}
##names(metals.allobs.log10)
metals.pca.df <- data.frame(Site=factor(metals.allobs.log10$Site), metals.pca$scores)

qplot(x=PC1, y=PC2, data=metals.pca.df, col=Site,
      title="Robust PCA Scores by Site")

qplot(x=PC1, y=PC2, data=metals.pca.df) + ggtitle("Robust PCA Scores by Site") +
    facet_wrap(~ Site)


## dim(metals.pca$scores)
## dim(metals.allobs.log10)
## New df on 2021.09.06
metals.robpca <- cbind(metals.allobs.log10, metals.pca$scores)
## dim(metals.robpca)
### about here
qplot(x=PC1, y=Mn55, data=metals.robpca, col=as.factor(Site))
qplot(x=PC1, y=Pb208, data=metals.robpca, col=as.factor(Site))
qplot(x=PC2, y=U238, data=metals.robpca, col=as.factor(Site))


write.csv(metals.robpca, file="metals_Impute_log10_PCA_scores.csv", quote=F, row.names=F)

```

```{r, omitHg}
pca_No_Hg <- robpca(metals.allobs.log10[,c(2:4, 6, 7)], k=5, alpha=.7, ndir="all",
                    skew=T)
round(pca_No_Hg[[2]]/sum(pca_No_Hg[[2]]), 3) ## .48  .19 .11
round(pca_No_Hg$loadings, 2)
## dim(pca_No_Hg$scores) ## 206 5
metals.noHg.robpca <- cbind(metals.allobs.log10, pca_No_Hg$scores)

write.csv(metals.noHg.robpca, file="metals_NoHg_log10_PCA_scores.csv", quote=F, row.names=F)
```

```{r, render, eval=F}
##system("pwd")
rmarkdown::render("yuma-metals-20210821.Rmd", 'html_document')
```

# Exploration of Yuma Datasets

Based on meeting with Drs. Dean Billheimer and Frank von Hippel on 9/2/2022, this general analysis will explore how PC1 and PC2 relate to the health outcome data from the survey conducted in Yuma, AZ in 2018.

$Note:$ The following scripts must be run prior to completing this analysis: Data_Clean.Rmd, Yuma_Metals_Analysis.Rmd, Demographics.Rmd, and yuma-metals-20210821.Rmd. This will provide the accurate dataframes used in the following code.

```{r notes}
#Pb isotopes were removed because they were all heavily collinear. 
##Perhaps so much so that the isotopes were calculated based on one reference one.
##Kept Pb208.

#The classic vs. robust PCAs were different enough that Dean felt like keeping the robust version was worth it. Even after logging the data, they are still skewed.

#PC1 is all positively correlated, which shows that it is an analysis of overall exposure.

#PC2 shows which ones are correlated in the same +ve or -ve directions.
```

## Counts of Cases and Controls for Each Outcome
These counts include only those who selected "yes" as cases and only those who explicitly selected "no" as controls. Others who chose options such as "don't know" or "prefer not to answer" or those who skipped the question were removed from these counts.
```{r counts}
#Numbers for each outcome
Case_Count <- Metals %>% 
  summarise("Arthritis"=sum(arthritis==1, na.rm = T),
            "Cancer"=sum(cancer==1, na.rm = T),
            "Cancer - EMR"=sum(emr_cancer==1, na.rm = T),
            "Goiter"=sum(goiter_recode==1, na.rm = T),
            "Goiter - EMR"=sum(emr_goiter==1, na.rm = T),
            "Thyroid Disease"=sum(thyroid_prob==1, na.rm = T),
            "Thyroid Disease - EMR"=sum(emr_thyroid_problem==1, na.rm = T),
            "Hypothyroidism"=sum(hypo_recode==1, na.rm = T),
            "Hypothyroidism - EMR"= sum(emr_hypothyroidism==1, na.rm = T),
            "Hyperthyroidism"=sum(hyper_recode==1, na.rm = T),
            "Hyperthyroidism - EMR"= sum(emr_hyperthyroidism==1, na.rm = T),
            "Thyroid Cancer"=sum(thy_cancer_recode==1, na.rm = T),
            "Thyroid Cancer - EMR"=sum(emr_thyroid_cancer==1, na.rm = T),
            "Diabetes Mellitus"=sum(dm_recode==1, na.rm = T),
            "Diabetes Mellitus - EMR"=sum(emr_dm_recode==1, na.rm = T),
            "Gout"=sum(gout==1, na.rm = T),
            "Congenital Heart Disease (CHD)"=sum(chd==1, na.rm = T),
            "Weak Kidney"=sum(weak_kidney==1, na.rm = T),
            "Hypertension"=sum(HTN==1, na.rm = T),
            "Stroke"=sum(stroke==1, na.rm = T),
            "Angina"=sum(angnia==1, na.rm = T),
            "Congestive Heart Failure (CHF)"=sum(chf==1, na.rm = T),
            "Heart Attack"=sum(heart_attack==1, na.rm = T),
            "Cholesterol"=sum(Cholesterol==1, na.rm = T),
            "PCOS"=sum(pos_recode==1, na.rm = T),
            "PCOS - EMR"=sum(emr_pos==1, na.rm = T),
            "Undescended Testes"=sum(undescended==1, na.rm = T),
            "Emphysema"=sum(emphysema==1, na.rm = T),
            "Autism Spectrum Disorder - EMR"=sum(emr_asd==1, na.rm = T),
            "Overweight"=sum(Overweight==1, na.rm = T),
            "Obesity - EMR"=sum(emr_obesity==1, na.rm = T),
            "Dental Health"=sum(Dental_health==4|Dental_health==5, na.rm = T))

Case_Count <- t(Case_Count)
colnames(Case_Count) <- c("Cases")

Control_Count <- Metals %>% 
  summarise("Arthritis"=sum(arthritis==2, na.rm = T),
            "Cancer"=sum(cancer==2, na.rm = T),
            "Cancer - EMR"=sum(emr_cancer==0, na.rm = T),
            "Goiter"=sum(goiter_recode==0, na.rm = T),
            "Goiter - EMR"=sum(emr_goiter==0, na.rm = T),
            "Thyroid Disease"=sum(thyroid_prob==2, na.rm = T),
            "Thyroid Disease - EMR"=sum(emr_thyroid_problem==0, na.rm = T),
            "Hypothyroidism"=sum(hypo_recode==0, na.rm = T),
            "Hypothyroidism - EMR"= sum(emr_hypothyroidism==0, na.rm = T),
            "Hyperthyroidism"=sum(hyper_recode==0, na.rm = T),
            "Hyperthyroidism - EMR"= sum(emr_hyperthyroidism==0, na.rm = T),
            "Thyroid Cancer"=sum(thy_cancer_recode==0, na.rm = T),
            "Thyroid Cancer - EMR"=sum(emr_thyroid_cancer==0, na.rm = T),
            "Diabetes Mellitus"=sum(dm_recode==0, na.rm = T),
            "Diabetes Mellitus - EMR"=sum(emr_dm_recode==0, na.rm = T),
            "Gout"=sum(gout==2, na.rm = T),
            "Congenital Heart Disease (CHD)"=sum(chd==2, na.rm = T),
            "Weak Kidney"=sum(weak_kidney==2, na.rm = T),
            "Hypertension"=sum(HTN==2, na.rm = T),
            "Stroke"=sum(stroke==2, na.rm = T),
            "Angina"=sum(angnia==2, na.rm = T),
            "Congestive Heart Failure (CHF)"=sum(chf==2, na.rm = T),
            "Heart Attack"=sum(heart_attack==2, na.rm = T),
            "Cholesterol"=sum(Cholesterol==2, na.rm = T),
            "PCOS"=sum(pos_recode==0, na.rm = T),
            "PCOS - EMR"=sum(emr_pos==0, na.rm = T),
            "Undescended Testes"=sum(undescended==2, na.rm = T),
            "Emphysema"=sum(emphysema==2, na.rm = T),
            "Autism Spectrum Disorder - EMR"=sum(emr_asd==0, na.rm = T),
            "Overweight"=sum(Overweight==2, na.rm = T),
            "Obesity - EMR"=sum(emr_obesity==0, na.rm = T),
            "Dental Health"=sum((Dental_health==1|Dental_health==2|Dental_health==3), na.rm = T))

Control_Count <- t(Control_Count)
colnames(Control_Count) <- c("Controls")

Case_Control <- cbind(Case_Count, Control_Count)
Case_Control <- as.data.frame(Case_Control)

Case_Control$Total <- Case_Control$Cases+Case_Control$Controls

kable(Case_Control)
```

Note from Frank on 9/3/2022: 

For the metals analysis, the health outcomes  don’t look to me like outcomes likely to be related to metals exposure. It’s worthwhile to graph them to see if anything comes out, but I don’t think it will. 

A couple of caveats: Research from laboratory animal studies show relationships between contaminant exposures and autism. I don’t think we have a big enough sample size to detect this, but it’s worth looking at.

I think you should compare our PC scores to BMI. We measured BMI so that should be available for every participant. Many contaminants are obesogenic.

Can we pull out the motor dysfunction health outcomes from our health survey and electronic medical records? I’m thinking of diseases such as Parkinson’s or anything else with a motor deficit. These can be caused by high exposure to metals.

# Graphical Visualizations

## Merging PCA with Survey and Health Data
```{r merge}
colnames(metals.robpca) <- c("ID", "Ln_Mn55", "Ln_Cu65", "Ln_Cd111", "Ln_Hg202", "Ln_Pb208", "Ln_U238", "Site", "PC1", "PC2", "PC3", "PC4", "PC5")

Metals <- merge(Metals, metals.robpca, by=c("ID", "Site"))

colnames(Metals) #will need to check to see if any of the col names need to change (e.g. instead of PC1 it is listed as PC1.x or PC1.y).
```

## BMI / Weight
```{r bmi2, include=F}
summary(Metals$bmi)
hist(Metals$bmi)

summary(Metals$emr_bmi)
hist(Metals$emr_bmi)

ggplot(Metals, aes(x=bmi, y=PC1, color=as.factor(Site)))+
  geom_point()+
  geom_smooth(method=lm, se=F)+
  scale_color_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  xlab("\nBMI")+
  theme_bw()

cor.test(Metals$PC1, Metals$bmi, method = "pearson") #is this the correct test to use?

ggplot(Metals, aes(x=bmi, y=PC2, color=as.factor(Site)))+
  geom_point()+
  geom_smooth(method=lm, se=F)+
  scale_color_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  xlab("\nBMI")+
  theme_bw()

cor.test(Metals$PC2, Metals$bmi, method = "pearson")
```

```{r bmi_ln}
#BMI looks to be skewed (lognormally distributed)
hist(log(Metals$bmi))
hist(log(Metals$emr_bmi))

ggplot(Metals, aes(x=log(bmi), y=PC1))+
  geom_point(aes(color=as.factor(Site)))+
  geom_smooth(method=lm, se=F)+
  scale_color_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  xlab("\nBMI")+
  theme_bw()

cor.test(Metals$PC1, log(Metals$bmi), method = "pearson") #is this the correct test to use?

ggplot(Metals, aes(x=log(bmi), y=PC2))+
  geom_point(aes(color=as.factor(Site)))+
  geom_smooth(method=lm, se=F)+
  scale_color_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  xlab("\nBMI")+
  theme_bw()

cor.test(Metals$PC2, log(Metals$bmi), method = "pearson")


#Looking at binary variables for weight / obesity

ggplot(subset(Metals, Overweight==1|Overweight==2), aes(x=as.factor(Overweight), y=PC1, fill=as.factor(Site)))+
  geom_boxplot()+
  scale_fill_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  scale_x_discrete(labels=c("1"="Yes", "2"="No"))+
  xlab("\nOverweight by Site")+
  theme_bw()

ggplot(subset(Metals, Overweight==1|Overweight==2), aes(x=as.factor(Overweight), y=PC1))+
  geom_boxplot()+
  scale_x_discrete(labels=c("1"="Yes", "2"="No"))+
  xlab("\nOverweight")+
  theme_bw()

ggplot(subset(Metals, Overweight==1|Overweight==2), aes(x=as.factor(Overweight), y=PC2, fill=as.factor(Site)))+
  geom_boxplot()+
  scale_fill_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  scale_x_discrete(labels=c("1"="Yes", "2"="No"))+
  xlab("\nOverweight by Site")+
  theme_bw()

ggplot(subset(Metals, Overweight==1|Overweight==2), aes(x=as.factor(Overweight), y=PC2))+
  geom_boxplot()+
  scale_x_discrete(labels=c("1"="Yes", "2"="No"))+
  xlab("\nOverweight")+
  theme_bw()

ggplot(subset(Metals, emr_obesity==1|emr_obesity==0), aes(x=as.factor(emr_obesity), y=PC1, fill=as.factor(Site)))+
  geom_boxplot()+
  scale_fill_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  scale_x_discrete(labels=c("1"="Yes", "0"="No"))+
  xlab("\nObesity (EMR)")+
  theme_bw()

ggplot(subset(Metals, emr_obesity==1|emr_obesity==0), aes(x=as.factor(emr_obesity), y=PC2, fill=as.factor(Site)))+
  geom_boxplot()+
  scale_fill_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  scale_x_discrete(labels=c("1"="Yes", "0"="No"))+
  xlab("\nObesity (EMR)")+
  theme_bw()
```

## Arthritis
```{r arthritis}
ggplot(subset(Metals, arthritis==1|arthritis==2), aes(x=as.factor(arthritis), y=PC1, fill=as.factor(Site)))+
  geom_boxplot()+
  scale_fill_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  scale_x_discrete(labels=c("1"="Yes", "2"="No"))+
  xlab("\nArthritis by Site")+
  theme_bw()

ggplot(subset(Metals, arthritis==1|arthritis==2), aes(x=as.factor(arthritis), y=PC1))+
  geom_boxplot()+
  scale_x_discrete(labels=c("1"="Yes", "2"="No"))+
  xlab("\nArthritis")+
  theme_bw()

ggplot(subset(Metals, arthritis==1|arthritis==2), aes(x=as.factor(arthritis), y=PC2, fill=as.factor(Site)))+
  geom_boxplot()+
  scale_fill_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  scale_x_discrete(labels=c("1"="Yes", "2"="No"))+
  xlab("\nArthritis")+
  theme_bw()
```

## Cancer
```{r cancer}
ggplot(subset(Metals, cancer==1|cancer==2), aes(x=as.factor(cancer), y=PC1, fill=as.factor(Site)))+
  geom_boxplot()+
  scale_fill_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  scale_x_discrete(labels=c("1"="Yes", "2"="No"))+
  xlab("\nCancers")+
  theme_bw()

ggplot(subset(Metals, cancer==1|cancer==2), aes(x=as.factor(cancer), y=PC2, fill=as.factor(Site)))+
  geom_boxplot()+
  scale_fill_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  scale_x_discrete(labels=c("1"="Yes", "2"="No"))+
  xlab("\nCancer")+
  theme_bw()
```

## Diabetes Mellitus
```{r dm}
ggplot(subset(Metals, dm_recode==1|dm_recode==0), aes(x=as.factor(dm_recode), y=PC1, fill=as.factor(Site)))+
  geom_boxplot()+
  scale_fill_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  scale_x_discrete(labels=c("1"="Yes", "0"="No"))+
  xlab("\nDiabetes Mellitus")+
  theme_bw()

ggplot(subset(Metals, dm_recode==1|dm_recode==0), aes(x=as.factor(dm_recode), y=PC2, fill=as.factor(Site)))+
  geom_boxplot()+
  scale_fill_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  scale_x_discrete(labels=c("1"="Yes", "0"="No"))+
  xlab("\nDiabetes Mellitus")+
  theme_bw()
```

## Cholesterol
```{r cholesterol}
ggplot(subset(Metals, Cholesterol==1|Cholesterol==2), aes(x=as.factor(Cholesterol), y=PC1, fill=as.factor(Site)))+
  geom_boxplot()+
  scale_fill_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  scale_x_discrete(labels=c("1"="Yes", "2"="No"))+
  xlab("\nCholesterol")+
  theme_bw()

ggplot(subset(Metals, Cholesterol==1|Cholesterol==2), aes(x=as.factor(Cholesterol), y=PC2, fill=as.factor(Site)))+
  geom_boxplot()+
  scale_fill_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  scale_x_discrete(labels=c("1"="Yes", "2"="No"))+
  xlab("\nCholesterol")+
  theme_bw()
```

## Dental Health
```{r dental}
ggplot(subset(Metals, Dental_health==1|Dental_health==2|Dental_health==3|Dental_health==4|Dental_health==5), aes(x=as.factor(Dental_health), y=PC1))+
  geom_boxplot()+
  scale_x_discrete(labels=c("1"="Excellent", "2"="Very Good", "3"="Good", "4"="Fair", "5"="Poor"))+
  xlab("\nDental Health")+
  theme_bw()

ggplot(subset(Metals, Dental_health==1|Dental_health==2|Dental_health==3|Dental_health==4|Dental_health==5), aes(x=as.factor(Dental_health), y=PC2))+
  geom_boxplot()+
  scale_x_discrete(labels=c("1"="Excellent", "2"="Very Good", "3"="Good", "4"="Fair", "5"="Poor"))+
  xlab("\nDental Health")+
  theme_bw()
```

# An Analysis of PC1 and PC2 Compared to Yuma Health Outcomes

$Note:$ The following scripts must be run prior to completing this analysis: Data_Clean.Rmd, Yuma_Metals_Analysis.Rmd, Demographics.Rmd, yuma-metals-20210821.Rmd, and Exploration.Rmd. This will provide the accurate dataframes used in the following code.

## Data Descriptions
```{r desc2}
#create_report(Metals) (Remove the # when you actually want to run - takes too much processing power otherwise.)
```


## Data Visualization - Exploratory

### Concentrations by Date
```{r envt_samples_by_collectiondate2}
#There is a single data point for the year 2013, with the rest being April-November 2018.
#This is likely either a mistake in input or some other error, but I will not include this point in subsequent analysis.
#The concentration values for this single row are blank anyway.
ggplot(Metals, aes(y=PC1, x=Date, color=as.factor(Site)))+
  geom_point()+
  geom_smooth(se=F)+
  scale_color_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  scale_x_date(date_breaks = "1 month", date_labels =  "%b")+
  ylab("PC1")+
  xlab("Date of Sample Collection")

ggplot(Metals, aes(y=PC2, x=Date, color=as.factor(Site)))+
  geom_point()+
  geom_smooth(se=F)+
  scale_color_discrete("Site", labels=c("1"="CSF", "2"="RCBH", "3"="YRMC"))+
  theme(panel.background = element_rect(fill="#ffffff"),
        axis.text.x=element_text(angle=60, hjust=1),
        axis.line = element_line(color="#000000"))+
  scale_x_date(date_breaks = "1 month", date_labels =  "%b")+
  ylab("PC2")+
  xlab("Date of Sample Collection")

#Relevant paper: https://www.sciencedirect.com/science/article/pii/S1878535212000263 
```

### Tables and Observations for Each Metal
```{r observations_envt_samples2}

Metals %>% 
  group_by(Site) %>% 
  summarize(number_NAs_PC1=sum(is.na(PC1)),
            number_NAs_PC2=sum(is.na(PC2)))


#Making a table re: PC values
knitr::kable(Metals %>%
               group_by(Site) %>% 
               summarize(n_PC1=sum(!is.na(PC1)),
                         geomean_PC1=round(exp(mean(PC1, na.rm = T)), digits = 2),
                         geosd_PC1=round(exp(sd(PC1, na.rm = T)), digits = 2),
                         n_PC2=sum(!is.na(PC2)),
                         geomean_PC2=round(exp(mean(PC2, na.rm = T)), digits = 2),
                         geosd_PC2=round(exp(sd(PC2, na.rm = T)), digits = 2)))

#create_report(data.melt) (Only run if you need to.)
```

### Distribution of PCA Data
```{r metal_distributions2}
hist(Metals$PC1)

hist(Metals$PC2)
```

### Plotting Hormone Levels Against Metal Concentrations
```{r metals_hormones2}
#Cortisol against PCA results
PC1_Cortisol <- ggplot(Metals, aes(x=PC1, y=Cortisol))+geom_point()
PC2_Cortisol <- ggplot(Metals, aes(x=PC2, y=Cortisol))+geom_point()

grid.arrange(PC1_Cortisol, PC2_Cortisol)
```